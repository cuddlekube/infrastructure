AWSTemplateFormatVersion: 2010-09-09
Description: CloudFormation Macro for expanding NACL entries and associations
Resources:
  TransformExecutionRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
        - Effect: Allow
          Principal:
            Service:
            - lambda.amazonaws.com
          Action:
          - sts:AssumeRole
      Path: /
      Policies:
      - PolicyName: root
        PolicyDocument:
          Version: 2012-10-17
          Statement:
          - Effect: Allow
            Action:
            - logs:*
            Resource: arn:aws:logs:*:*:*
  TransformFunction:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket: ccau-artefacts-bucket-5dm2b0kss7fd
        S3Key: c4176a60ea0508d3995a279d674fcdb2
      Handler: macro.handler
      Runtime: python3.7
      Role:
        Fn::GetAtt:
        - TransformExecutionRole
        - Arn
  TransformFunctionPermissions:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - TransformFunction
        - Arn
      Principal: cloudformation.amazonaws.com
  Transform:
    Type: AWS::CloudFormation::Macro
    Properties:
      Name: NaclExpander
      Description: Expands NACL rulesets
      FunctionName:
        Fn::GetAtt:
        - TransformFunction
        - Arn
